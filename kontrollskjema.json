{
  "version": "1.1",
  "last_updated": "2025-11-05",
  "description": "Kontrollskjema for standardisering av tabeller i statistikkbanken",
  
  "standard_variables": {
    "år": {
      "required_name": "år",
      "description": "Årstall for statistikken",
      "data_type": "integer",
      "alternative_names": ["årgang", "aargang", "År", "year", "periode"],
      "validation": {
        "min": 1900,
        "max": 2100,
        "format": "YYYY"
      },
      "notes": "Alltid med små bokstaver. Fire sifre. Kan ha æøå-encoding i rådata."
    },
    
    "geografi": {
      "required_name": "geografi",
      "description": "Geografisk enhet (bydel, grunnkrets, etc.)",
      "data_type": "string",
      "alternative_names": ["bydel", "bo_bydel", "b_bydel", "område", "region", "geo", "delbydel", "b_delbydel2017_01"],
      "codelists": ["SSB_til_PX_geo_bydel", "SSB_til_PX_geo_kommune", "SSB_til_PX_geo_grunnkrets"],
      "notes": "Bruk PX-kode fra kodelister. Legg til separat navn-kolonne hvis nødvendig. Ignorer _fmt-kolonner."
    },
    
    "kjønn": {
      "required_name": "kjønn",
      "description": "Kjønn",
      "data_type": "string",
      "alternative_names": ["kjonn", "kjoenn", "KJOENN", "Kjønn", "gender", "sex", "kjoenn_fmt"],
      "allowed_values": {
        "0": "Begge kjønn",
        "1": "Mann",
        "2": "Kvinne"
      },
      "notes": "Standard SSB-koding. Output skal bruke tekstverdi (Mann/Kvinne/Begge kjønn), ikke koder."
    },
    
    "alder": {
      "required_name": "alder",
      "description": "Alder eller aldersgruppe",
      "data_type": "string",
      "alternative_names": ["Alder", "age", "aldersgruppe", "aldersgrupper", "ALDGR16a_", "aldgr16a__fmt"],
      "notes": "Output format: '15-24 år', '25-39 år' etc. Konsistent formattering med mellomrom og 'år'."
    },
    
    "antall": {
      "required_name": "antall",
      "description": "Antall observasjoner/personer",
      "data_type": "integer",
      "alternative_names": ["Antall", "count", "n", "sum"],
      "notes": "Alltid små bokstaver. Heltall."
    },
    
    "andel": {
      "required_name": "andel",
      "description": "Andel i prosent",
      "data_type": "float",
      "alternative_names": ["Andel", "prosent", "pct", "percentage", "andeler"],
      "validation": {
        "min": 0,
        "max": 100,
        "decimals": 1
      },
      "notes": "Alltid i prosent (0-100), ikke desimal (0-1). Én desimal."
    },
    
    "sysselsatte": {
      "required_name": "sysselsatte",
      "description": "Antall sysselsatte personer",
      "data_type": "integer",
      "alternative_names": ["antall_sysselsatte", "sysselsetting", "employed"],
      "notes": "Brukes i sysselsettingstabeller. Heltall."
    },
    
    "befolkning": {
      "required_name": "befolkning",
      "description": "Antall personer i befolkningen",
      "data_type": "integer",
      "alternative_names": ["antall_befolkning", "befolkn", "population"],
      "notes": "Brukes som nevner for andeler. Heltall."
    }
  },
  
  "geographic_coding": {
    "description": "Krav til geografisk koding for PxWeb",
    "rules": [
      "Bruk alltid PX-koder fra kodelister, ikke SSB-koder direkte",
      "Inkluder både kode og navn i separate kolonner hvis mulig",
      "For TKNR: Bruk NAV_TKNR_til_PX kodeliste",
      "For SSB-koder: Bruk riktig SSB_til_PX_geo_* kodeliste"
    ],
    
    "required_codelists": {
      "kommune": "SSB_til_PX_geo_kommune",
      "bydel": "SSB_til_PX_geo_bydel",
      "delbydel": "SSB_til_PX_geo_delbydel",
      "grunnkretsområde": "SSB_til_PX_geo_grunnkretsområde",
      "grunnkrets": "SSB_til_PX_geo_grunnkrets",
      "tknr": "NAV_TKNR_til_PX"
    },
    
    "naming_convention": {
      "code_column": "geografi_kode eller [nivå]_kode (f.eks. bydel_kode)",
      "label_column": "geografi_navn eller [nivå]_navn (f.eks. bydel_navn)"
    }
  },
  
  "data_sources": {
    "ssb_sas_extracts": {
      "description": "Data hentet fra SSB sine databaser via SAS",
      "characteristics": [
        "Kolonnepar: variabel (kode) + variabel_fmt (tekst/navn)",
        "XML-encoding av spesialtegn og tall (_x0030_ = '0', _x0032_ = '2' osv.)",
        "STORE BOKSTAVER i noen variabelnavn",
        "Eksempel: bydel2='030101', bydel2_fmt='Gamle Oslo'"
      ],
      "handling": {
        "code_columns": "Bruk for matching mot kodelister (SSB til PX)",
        "fmt_columns": "Bruk som fallback-navn hvis kodeliste ikke finnes",
        "when_codelist_exists": "Bruk kodeliste for både kode-transformasjon OG standardiserte navn",
        "when_no_codelist": "Behold både kode og _fmt (som _navn)"
      }
    }
  },
  
  "naming_conventions": {
    "general_rules": [
      "Alle variabelnavn skal være små bokstaver",
      "Bruk understrek (_) for å skille ord, ikke mellomrom eller bindestrek",
      "Norske tegn (æ, ø, å) er tillatt i variabelnavn",
      "Vær konsistent med eksisterende tabeller"
    ],
    
    "forbidden_patterns": [
      "Mellomrom i variabelnavn",
      "Store bokstaver (unntatt akronymer som faste verdier)",
      "Bindestrek (-) i variabelnavn",
      "Spesialtegn unntatt understrek (_)"
    ]
  },
  
  "data_quality": {
    "missing_values": {
      "numeric": null,
      "text": "",
      "notes": "Bruk null/NaN for manglende tallverdier, tom streng for tekst"
    },
    
    "decimal_separator": ".",
    "thousands_separator": "",
    "date_format": "YYYY-MM-DD",
    
    "validation_rules": [
      "Alle geografiske koder må finnes i kodelister",
      "Prosentverdier må være 0-100",
      "Årstall må være realistiske (1900-2100)",
      "Ingen duplikate rader (samme kombinasjon av nøkkelvariabler)"
    ]
  },
  
  "table_structure": {
    "required_columns": {
      "description": "Kolonner som alltid bør være med hvis relevant",
      "columns": ["år", "geografi"]
    },
    
    "column_order": {
      "description": "Anbefalt rekkefølge på kolonner",
      "order": [
        "år",
        "geografi_kode",
        "geografi_navn",
        "kjønn",
        "alder",
        "kategori_variabler",
        "antall",
        "andel"
      ]
    }
  },
  
  "domain_specific": {
    "befolkning": {
      "standard_variables": ["år", "geografi", "geografi_navn", "kjønn", "alder", "antall"],
      "notes": "Befolkningsstatistikk følger SSB-standard",
      "example_tables": ["OK-BEF001"]
    },
    
    "sysselsetting": {
      "standard_variables": ["år", "geografi", "geografi_navn", "kjønn", "alder", "sysselsatte", "befolkning", "andel"],
      "calculation": "andel = (sysselsatte / befolkning) * 100",
      "notes": "Krever ofte join mellom sysselsettings- og befolkningsdata. Aldersgrupper må være konsistente.",
      "example_tables": ["OK-SYS001", "OK-SYS002", "OK-SYS003"],
      "common_patterns": {
        "fmt_columns": "SAS-uttrekk fra SSB har par av kolonner: 'variabel' (kode) og 'variabel_fmt' (navn/tekst). Begge trengs vanligvis, UNNTATT når kodeliste brukes (da hentes navn fra kodeliste).",
        "xml_encoding": "Input kan ha XML-encoded verdier (_x0030_ osv.) som må dekodes",
        "column_case": "Input kan ha STORE BOKSTAVER, skal bli små i output",
        "code_and_label_pairs": "Typiske par: bydel/bydel_fmt, kjoenn/kjoenn_fmt, aldgr/aldgr_fmt"
      }
    },
    
    "utdanning": {
      "standard_variables": ["år", "geografi", "kjønn", "alder", "utdanningsnivå", "antall"],
      "notes": "Utdanningsnivå følger NUS-koding"
    }
  },
  
  "changelog": [
    {
      "date": "2025-11-05",
      "version": "1.1",
      "changes": "Oppdatert basert på treningsdata (OK-SYS001-003). Lagt til alternative navn fra SSB-uttrekk, støtte for XML-encoding, _fmt-kolonner, sysselsatte/befolkning-variabler."
    },
    {
      "date": "2025-11-05",
      "version": "1.0",
      "changes": "Initielt kontrollskjema opprettet"
    }
  ]
}
